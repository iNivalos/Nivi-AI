:root{
  --chatGutterL: var(--text-inset-l);
  --chatGutterR: var(--text-inset-r);

  --chatTop: 73px;
  --chatBottom: 90px;
  --headerRuleInset: 92px;
  --headerRuleOpacity: 0.18;
  --paper:#FEFDEE;
  --ink:#0A0F14;
  --cyan:#4EE6C9;
  --user:#2E3F4A;

  --line: 22px;
  --font: 15px;
  --max-lines: 3;

  --field-radius: 14px;
  --field-pad-y: 14px;
  --field-pad-x: 18px;    

  --text-inset-l: 18px;
  --text-inset-r: 62px;
  --text-air-edge: 6px;

  --send-size: 40px;
  --send-inset: 6.5px;
}

html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#071b24;
  overflow:hidden;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}

.scene{
  position:relative;
  width:100%;
  height:100%;
  background:url("../images/fondo_nivalis.png") center/cover no-repeat;
  z-index:0;
}

.paperWrap{
  position: relative;
  z-index: 2;
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:80px 24px 40px;
}

.paper{
  width:min(820px,92vw);
  height:min(720px,86vh);
  background:var(--paper);
  border-radius:28px;
  position:relative;
  overflow:hidden;
}

#introLayer,#chatLayer{ position:absolute; inset:0;   z-index:1;
}

#introLayer{
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;

  position:relative;

  padding-top:clamp(24px, 6vh, 54px);
  padding-bottom:clamp(92px, 12vh, 120px);

  opacity:1;
  transform:translateZ(0);
  transition:opacity 600ms ease-in-out, transform 600ms ease-in-out;
}

.healingSticker{ width:clamp(150px, 18vw, 200px); height:auto; margin-bottom:clamp(6px, 1.4vh, 12px); }

.introTitle{
  font-family:"Segoe Print","Comic Sans MS",system-ui;
  font-size:clamp(26px, 3.2vw, 32px);
  font-weight:700;
  color:var(--ink);
  margin-bottom:clamp(10px, 3vh, 22px);
  opacity:0.95;
}

.introLines{
  width:min(520px, 84%);
  margin:clamp(18px, 6vh, 44px) auto 0;
  margin-bottom:0;
  display:flex;
  flex-direction:column;
  gap:clamp(4px, 1vh, 8px);
}

.introSlot{
  position:relative;
  height:clamp(28px, 4.2vh, 36px);
}
.introSlot::after{
  content:"";
  position:absolute;

  left:50%;
  width:min(76%, 420px);
  transform:translateX(-50%);

  bottom:clamp(5px, 1.2vh, 7px);
  height:1px;
  background: rgba(10, 15, 20, 0.09);
  border-radius:999px;
}
.introText{
  position:absolute;

  left:50%;
  width:min(76%, 420px);
  transform:translateX(-50%);

  bottom:clamp(8px, 1.8vh, 12px);
  font-family:"Segoe Print","Comic Sans MS",system-ui;
  font-size:clamp(18px, 2.4vw, 20px);
  color:rgba(10,15,20,0.85);
  text-align:center;

  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

#enterBtn{
  position:absolute;
  left:50%;
  bottom: calc(clamp(16px, 3vh, 26px) - 30px);
  transform:translateX(-50%);

  margin:0;
  background:var(--user);
  color:var(--cyan);
  border:none;
  border-radius:14px;
  padding:clamp(10px, 1.8vh, 12px) clamp(22px, 3vw, 28px);
  font-family:"Segoe Print","Comic Sans MS",system-ui;
  font-size:clamp(15px, 2.0vw, 17px);
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}
#enterBtn:active{ transform:translateX(-50%) scale(0.99); }

@media (max-height: 720px){
  #introLayer{ padding-top:clamp(18px, 5vh, 44px); }
  .introLines{ margin-top:clamp(14px, 4vh, 28px); }
  .introSlot{ height:clamp(26px, 3.8vh, 32px); }
}

#chatLayer{
  opacity:0;
  pointer-events:none;
  transition:opacity 500ms ease-in-out;
}

.chatHeader{
  position:absolute;
  top:24px;
  left:0;
  right:0;
  text-align:center;
  font-family:"Segoe Print","Comic Sans MS",system-ui;
  font-size:22px;
  font-weight:700;
  color:var(--ink);
  opacity:0.9;
}

.chatArea{
  position:absolute;
  top:var(--chatTop);
  bottom:var(--chatBottom);
  left:0;
  right:0;
  padding:0 48px;
  overflow-y:auto;
}

.inputBar{
  position:absolute;
  bottom:24px;
  left:48px;
  right:48px;
}

.inputField{
  position:relative;
  width:100%;
  background:var(--user);
  border-radius:var(--field-radius);
  padding:var(--field-pad-y) var(--field-pad-x);
  box-sizing:border-box;
}

.textColumn{
  position:relative;
  margin-left: calc(var(--text-inset-l) - var(--field-pad-x));
  margin-right: calc(var(--text-inset-r) - var(--field-pad-x));
}

.textColumn::before,
.textColumn::after{
  content:"";
  position:absolute;
  left:0;
  right:0;
  pointer-events:none;
  z-index:2;
}

.textColumn::before{
  top:0;
  height:var(--text-air-edge);
  background:linear-gradient(to bottom, var(--user) 55%, rgba(46,63,74,0));
}

.textColumn::after{
  bottom:0;
  height:var(--text-air-edge);
  background:linear-gradient(to top, var(--user) 55%, rgba(46,63,74,0));
}

#msgInput{
  position:relative;
  z-index:1;
  width:100%;
  box-sizing:border-box;
  border:none;
  outline:none;
  resize:none;
  background:transparent;

  color:#EAF6F4;
  font-size:var(--font);
  line-height:var(--line);

  min-height: calc((1 * var(--line)));
  max-height: calc((var(--max-lines) * var(--line)));

  padding:0;
  overflow-y:hidden;
}

#msgInput.scrollable{ overflow-y:auto; }

#msgInput::-webkit-scrollbar{ width:0; height:0; }
#msgInput{ scrollbar-width:none; }

#msgInput::placeholder{ color:#AFCBC6; }

.sendBtn{
  position:absolute;
  right:var(--send-inset);
  bottom:var(--send-inset);
  width:var(--send-size);
  height:var(--send-size);
  border-radius:999px;
  border:none;
  background:var(--cyan);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}

.sendBtn svg{
  width:22px;
  height:22px;
  fill:#06332B;
}


.bubbleRow{
  display:flex;
  margin:10px 0;
}

.bubbleRow.healing{ justify-content:flex-start; }
.bubbleRow.user{ justify-content:flex-end; }

.bubble{
  max-width: min(520px, 68%);
  padding:12px 14px;
  border-radius:16px;
  font-size:15px;
  line-height:22px;
  white-space:pre-wrap;
  word-break:break-word;
}

.bubble.healing{
  background: rgba(78, 230, 201, 0.22);
  color: rgba(10, 15, 20, 0.92);
}

.bubble.user{
  background: rgba(46, 63, 74, 0.92);
  color: #EAF6F4;
}

.bubbleRow.healing .bubble{ margin-left: 2px; }
.bubbleRow.user .bubble{ margin-right: 2px; }

.headerRule{
  position:absolute;
  top:62px; 
  left:var(--headerRuleInset);
  right:var(--headerRuleInset);
  height:1px;
  background: rgba(10, 15, 20, var(--headerRuleOpacity));
  border-radius:999px;
}

.footerRule{
  position:absolute;
  left:var(--headerRuleInset);
  right:var(--headerRuleInset);
  bottom:calc(var(--chatBottom) - 2px);
  height:1px;
  background: rgba(10, 15, 20, var(--headerRuleOpacity));
  border-radius:999px;
}

.bubbleRow{
  padding-left: var(--chatGutterL);
  padding-right: var(--chatGutterR);
}

.bubbleRow.healing{ justify-content:flex-start; }
.bubbleRow.user{ justify-content:flex-end; }

.bubbleRow.user{
  padding-right: calc(var(--chatGutterR) - 56px);
}

.typing{
  display:flex;
  align-items:center;
  gap:6px;
  padding:10px 12px;
  border-radius:16px;
  background: rgba(78, 230, 201, 0.22);
  box-sizing:border-box;
  max-width: min(220px, 46%);
}
.typing .dot{
  width:7px;
  height:7px;
  border-radius:50%;
  background: rgba(10, 15, 20, 0.55);
  animation: hsTyping 1.05s infinite ease-in-out;
}
.typing .dot:nth-child(2){ animation-delay: 0.15s; }
.typing .dot:nth-child(3){ animation-delay: 0.30s; }

@keyframes hsTyping{
  0%, 80%, 100%{ transform: translateY(0); opacity:0.35; }
  35%{ transform: translateY(-3px); opacity:0.9; }
}

.bubbleRow.healing .typing{ margin-left: 2px; }

#snowCanvas{
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 1;
}

.paperMusicBtn,
.paperLockBtn{
  position:absolute;
  top:22px;
  width:24px;
  height:24px;
  background: transparent;
  border:none;
  box-shadow:none;
  outline:none;
  padding:0;
  margin:0;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  transition: opacity 200ms ease, transform 120ms ease;
  z-index:30;
}

.paperMusicBtn{ right:18px; opacity:0.55; color: rgba(10,15,20,0.62); }
.paperLockBtn { left:18px;  opacity:0.32; color: rgba(150,150,150,0.85); }

.paperMusicBtn:hover{ opacity:0.78; }
.paperLockBtn:hover { opacity:0.50; }

.paperMusicBtn:active,
.paperLockBtn:active{ transform: scale(0.96); }

.paperMusicBtn svg,
.paperLockBtn svg{
  width:18px;
  height:18px;
  display:block;
}

.paperMusicBtn.isOn{ opacity:0.9; }

#enterBtn{
  border: none;
  outline: none;
  box-shadow: none;
}
#enterBtn:focus,
#enterBtn:focus-visible,
#enterBtn:active{
  outline: none;
  box-shadow: none;
}
